<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Examples &mdash; metobs_toolkit 0.0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="User documentation" href="usrdocumentation.html" />
    <link rel="prev" title="Introduction" href="intro.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="index.html" class="icon icon-home">
            metobs_toolkit
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#making-a-dataset">Making a Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extracting-a-station">Extracting a Station</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-to-a-file">Writing to a file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#physiography-information">Physiography information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#applying-qualitycontrol">Applying Qualitycontrol</a></li>
<li class="toctree-l2"><a class="reference internal" href="#making-spatial-plots">Making spatial plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="#making-timeseries-plots">Making timeseries plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Making spatial plots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usrdocumentation.html">User documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="devdocumentation.html">Developper documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">metobs_toolkit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Examples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/examples.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="examples">
<h1><a class="toc-backref" href="#id2" role="doc-backlink">Examples</a><a class="headerlink" href="#examples" title="Permalink to this heading"></a></h1>
<nav class="contents" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#examples" id="id2">Examples</a></p>
<ul>
<li><p><a class="reference internal" href="#making-a-dataset" id="id3">Making a Dataset</a></p></li>
<li><p><a class="reference internal" href="#extracting-a-station" id="id4">Extracting a Station</a></p></li>
<li><p><a class="reference internal" href="#writing-to-a-file" id="id5">Writing to a file</a></p></li>
<li><p><a class="reference internal" href="#physiography-information" id="id6">Physiography information</a></p></li>
<li><p><a class="reference internal" href="#applying-qualitycontrol" id="id7">Applying Qualitycontrol</a></p></li>
<li><p><a class="reference internal" href="#making-spatial-plots" id="id8">Making spatial plots</a></p></li>
<li><p><a class="reference internal" href="#making-timeseries-plots" id="id9">Making timeseries plots</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id10">Making spatial plots</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>Some examples to get you started.</p>
<section id="making-a-dataset">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Making a Dataset</a><a class="headerlink" href="#making-a-dataset" title="Permalink to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">metobs_toolkit</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 5</span><span class="c1"># Dataset</span>
<span class="linenos"> 6</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c1"># A dataset is a collection of all observational data. Most of the methods are</span>
<span class="linenos"> 9</span><span class="c1"># applied directly on a dataset. Always start by initializing a dataset object:</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="n">aug_2020_all_vlinders</span> <span class="o">=</span> <span class="n">metobs_toolkit</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
<span class="linenos">12</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="c1"># we created an dataset and stored in under the variable &#39;aug_2020_all_vlinder&#39;.</span>
<span class="linenos">15</span><span class="c1"># The show function prints out an overview of data in the dataset:</span>
<span class="linenos">16</span><span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="c1"># =============================================================================</span>
<span class="linenos">19</span><span class="c1"># Importing data</span>
<span class="linenos">20</span><span class="c1"># =============================================================================</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="c1"># To import data, you must specify where your data (and additional templates) are.</span>
<span class="linenos">23</span><span class="c1"># All this information is stored in the Settings of a dataset. To get an overview</span>
<span class="linenos">24</span><span class="c1"># of all the settings:</span>
<span class="linenos">25</span><span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">show_settings</span><span class="p">()</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="c1"># you can see that the settings contain default values. But there are no default</span>
<span class="linenos">28</span><span class="c1"># values for where your data is. So you have to update the settings.</span>
<span class="linenos">29</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="c1"># Start by updating the settings of your dataset so it knows here the data files are:</span>
<span class="linenos">32</span>
<span class="linenos">33</span>
<span class="linenos">34</span><span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">input_data_file</span><span class="o">=</span><span class="n">testdata_file</span><span class="p">,</span> <span class="c1">#A demo data file, downloaded with brian tool: https://vlinder.ugent.be/vlinderdata/multiple_vlinders.php</span>
<span class="linenos">35</span>                         <span class="n">input_metadata_file</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
<span class="linenos">36</span>                         <span class="n">output_folder</span><span class="o">=</span><span class="s1">&#39;/home/$USER/output/&#39;</span><span class="p">,</span>
<span class="linenos">37</span>                         <span class="n">data_template_file</span><span class="o">=</span><span class="n">templatefile</span><span class="p">,</span>
<span class="linenos">38</span>                         <span class="n">metadata_template_file</span><span class="o">=</span><span class="n">templatefile</span><span class="p">)</span>
<span class="linenos">39</span>
<span class="linenos">40</span>
<span class="linenos">41</span>
<span class="linenos">42</span><span class="c1"># ---------------- Importing from CSV file -------------------------------</span>
<span class="linenos">43</span>
<span class="linenos">44</span>
<span class="linenos">45</span><span class="c1">#The dataset is initiated but still empty. Filling it with the data from a csv file is simply done by:</span>
<span class="linenos">46</span>
<span class="linenos">47</span><span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">import_data_from_file</span><span class="p">()</span> <span class="c1">#Rember that you added the input file in the settings object, this file will be used.</span>
<span class="linenos">48</span>
<span class="linenos">49</span><span class="c1"># Now the dataset is filled with your data.</span>
<span class="linenos">50</span><span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="linenos">51</span>
</pre></div>
</div>
</section>
<section id="extracting-a-station">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Extracting a Station</a><a class="headerlink" href="#extracting-a-station" title="Permalink to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 2</span><span class="c1"># Analysing one station</span>
<span class="linenos"> 3</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="c1">#if you are interested in one station, you can extract all the info for that one station from the dataset by:</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="n">favorite_station</span> <span class="o">=</span> <span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">get_station</span><span class="p">(</span><span class="n">stationname</span><span class="o">=</span><span class="s1">&#39;vlinder02&#39;</span><span class="p">)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="c1">#the variable favorite_station now contains all info about that station. If you would like to have the observation in a tabular form (pandas dataframe):</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="n">observations</span> <span class="o">=</span> <span class="n">favorite_station</span><span class="o">.</span><span class="n">df</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="nb">print</span><span class="p">(</span><span class="n">observations</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="linenos">14</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="c1">#Or you can make a timeseries plot for a field of chose:</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="n">favorite_station</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">obstype</span><span class="o">=</span><span class="s1">&#39;temp&#39;</span><span class="p">)</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="c1">#You can extract attributes from the station:</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">favorite_station</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span>
<span class="linenos">23</span>
</pre></div>
</div>
</section>
<section id="writing-to-a-file">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Writing to a file</a><a class="headerlink" href="#writing-to-a-file" title="Permalink to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 2</span><span class="c1"># Writing to a file</span>
<span class="linenos"> 3</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="c1"># to write the dataset to a file, specify an outputfolder first. The data will be written there.</span>
<span class="linenos"> 6</span><span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">output_folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="c1"># To write the output to a file the following function can be used:</span>
<span class="linenos">10</span><span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">write_to_csv</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;testdata.csv&#39;</span><span class="p">,</span>
<span class="linenos">11</span>                                   <span class="n">include_outliers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">12</span>                                   <span class="n">add_final_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">13</span>                                   <span class="n">use_tlk_obsnames</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">14</span>                                   <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="physiography-information">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Physiography information</a><a class="headerlink" href="#physiography-information" title="Permalink to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 2</span><span class="c1">#  Get LCZ</span>
<span class="linenos"> 3</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="c1"># To use the LCZ functions, you need a google develeopers account to make use of google earth engine (gee).</span>
<span class="linenos"> 6</span><span class="c1"># Creating first such an account, thans simply use this function to extract the LCZ for all stations in your metadata</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="n">lcz_values</span> <span class="o">=</span> <span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">get_lcz</span><span class="p">()</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="nb">print</span><span class="p">(</span><span class="n">lcz_values</span><span class="p">)</span>
<span class="linenos">11</span><span class="c1">#Now the metadata is updated with lcz information for each station in the &#39;lcz&#39; column:</span>
<span class="linenos">12</span><span class="nb">print</span><span class="p">(</span><span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">metadf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="linenos">13</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="c1"># =============================================================================</span>
<span class="linenos">16</span><span class="c1"># Analysing LCZ</span>
<span class="linenos">17</span><span class="c1"># =============================================================================</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="c1">#You can recompute the lcz for all stations by calling the get_lcz function on the metadata.</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="c1"># To make a geospatial map of the LCZ of all stations:</span>
<span class="linenos">22</span><span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">make_geo_plot</span><span class="p">(</span><span class="n">obstype</span><span class="o">=</span><span class="s1">&#39;lcz&#39;</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="c1"># =============================================================================</span>
<span class="linenos">25</span><span class="c1"># Other physiography</span>
<span class="linenos">26</span><span class="c1"># =============================================================================</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="c1"># it is possible to extract the landcover fractions of all stations. This is done</span>
<span class="linenos">29</span><span class="c1"># by defining a radius in meters to create a circular buffer around each station.</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="c1"># You can select to aggregate the landcoverclasses to water - pervious and impervious,</span>
<span class="linenos">32</span><span class="c1"># or set aggregation to false to extract the landcoverclasses as present in the worldcover dataset.</span>
<span class="linenos">33</span>
<span class="linenos">34</span><span class="c1"># aggregated</span>
<span class="linenos">35</span><span class="n">agg_landcover</span> <span class="o">=</span> <span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">get_landcover</span><span class="p">(</span><span class="n">buffer</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="c1">#in meters</span>
<span class="linenos">36</span>                                    <span class="n">aggregate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">37</span>
<span class="linenos">38</span><span class="nb">print</span><span class="p">(</span><span class="n">agg_landcover</span><span class="p">)</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="c1"># (the metadata is updated as well)</span>
<span class="linenos">41</span><span class="nb">print</span><span class="p">(</span><span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">metadf</span><span class="p">)</span>
<span class="linenos">42</span>
<span class="linenos">43</span>
<span class="linenos">44</span><span class="c1"># one can also extract the elevation for all stations from a DEM dataset. The syntax is the same</span>
<span class="linenos">45</span><span class="c1"># as for the LCZ</span>
<span class="linenos">46</span>
<span class="linenos">47</span>
<span class="linenos">48</span><span class="n">altitude</span> <span class="o">=</span> <span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">get_altitude</span><span class="p">()</span>
<span class="linenos">49</span>
<span class="linenos">50</span><span class="nb">print</span><span class="p">(</span><span class="n">altitude</span><span class="p">)</span> <span class="c1">#altitude in meters</span>
<span class="linenos">51</span>
<span class="linenos">52</span>
</pre></div>
</div>
</section>
<section id="applying-qualitycontrol">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Applying Qualitycontrol</a><a class="headerlink" href="#applying-qualitycontrol" title="Permalink to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span>
<span class="linenos">  2</span>
<span class="linenos">  3</span><span class="c1"># =============================================================================</span>
<span class="linenos">  4</span><span class="c1"># Applying quality control</span>
<span class="linenos">  5</span><span class="c1"># =============================================================================</span>
<span class="linenos">  6</span>
<span class="linenos">  7</span><span class="c1">#  a number of quality control methods are available in the toolkit. We can classify them in two groups:</span>
<span class="linenos">  8</span>    <span class="c1"># 1) Quality control for missing/duplicated timestamps</span>
<span class="linenos">  9</span>
<span class="linenos"> 10</span>        <span class="c1">#These are automatically performed when the dataset is created</span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span>    <span class="c1"># 2) Quality control for bad observations</span>
<span class="linenos"> 13</span>
<span class="linenos"> 14</span>        <span class="c1">#These are not automatically executed. These checks are performd in a sequence</span>
<span class="linenos"> 15</span>        <span class="c1"># of specific checks, that are looking for signatures of typically bad observations.</span>
<span class="linenos"> 16</span>        <span class="c1"># The following checks are available:</span>
<span class="linenos"> 17</span>            <span class="c1"># Gross value check: a threshold check that observations should be between the thresholds</span>
<span class="linenos"> 18</span>            <span class="c1"># Persistance check: a check that looks for repetitive observation values (indicating a connection error.)</span>
<span class="linenos"> 19</span>            <span class="c1"># Spike check: Check if an observation does not change between two timestamps by more than a threshold.</span>
<span class="linenos"> 20</span>            <span class="c1"># Internal consistency check: Check if the temperature observations are physically valid based on relative humidity observations.</span>
<span class="linenos"> 21</span>
<span class="linenos"> 22</span><span class="c1">#All settings, labels, replacement values are defind in the default settings in /settings_files/qc_settings.py</span>
<span class="linenos"> 23</span><span class="c1">#To inspect (and change) these quality control settings, you can extract them out of the Settings:</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span>
<span class="linenos"> 26</span><span class="n">qc_settings</span> <span class="o">=</span> <span class="n">sept_2022_all_vlinders</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">qc</span><span class="p">[</span><span class="s1">&#39;qc_check_settings&#39;</span><span class="p">]</span> <span class="c1">#Settings are stored in nested dictionary</span>
<span class="linenos"> 27</span><span class="nb">print</span><span class="p">(</span><span class="n">qc_settings</span><span class="p">)</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span><span class="c1">#Changing a setting example:</span>
<span class="linenos"> 30</span><span class="n">qc_settings</span><span class="p">[</span><span class="s1">&#39;persistance&#39;</span><span class="p">][</span><span class="s1">&#39;temp&#39;</span><span class="p">][</span><span class="s1">&#39;max_valid_repetitions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
<span class="linenos"> 31</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span><span class="c1"># Quality control checks are always applied on the full dataset Using the apply_quality_control method on the dataset.</span>
<span class="linenos"> 36</span>
<span class="linenos"> 37</span><span class="n">sept_2022_all_vlinders</span><span class="o">.</span><span class="n">apply_quality_control</span><span class="p">(</span><span class="n">obstype</span><span class="o">=</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="c1">#which observations to check</span>
<span class="linenos"> 38</span>                                             <span class="n">gross_value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1">#apply gross_value check?</span>
<span class="linenos"> 39</span>                                             <span class="n">persistance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1">#apply persistance check?</span>
<span class="linenos"> 40</span>                                             <span class="n">step</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1">#apply the step chec?</span>
<span class="linenos"> 41</span>                                             <span class="n">window_variation</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># apply internal consistency check?</span>
<span class="linenos"> 42</span>                                             <span class="p">)</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span><span class="c1"># ----- INTERMEZZO ------</span>
<span class="linenos"> 45</span><span class="c1"># quality control methods can also be applied on station level. Be aware that the QC labels are an attribute of the station</span>
<span class="linenos"> 46</span><span class="c1"># and not of the dataset the station belongs to!</span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span><span class="n">station</span> <span class="o">=</span> <span class="n">sept_2022_all_vlinders</span><span class="o">.</span><span class="n">get_station</span><span class="p">(</span><span class="s1">&#39;vlinder01&#39;</span><span class="p">)</span>
<span class="linenos"> 49</span>
<span class="linenos"> 50</span><span class="n">station</span><span class="o">.</span><span class="n">apply_quality_control</span><span class="p">()</span>
<span class="linenos"> 51</span>
<span class="linenos"> 52</span><span class="nb">print</span><span class="p">(</span><span class="n">station</span><span class="o">.</span><span class="n">outliersdf</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="linenos"> 53</span>
<span class="linenos"> 54</span>
<span class="linenos"> 55</span>
<span class="linenos"> 56</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 57</span><span class="c1"># Quality control values</span>
<span class="linenos"> 58</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 59</span>
<span class="linenos"> 60</span><span class="c1"># If an observation is flagged as an outlier by a check, the observational value is replaced.</span>
<span class="linenos"> 61</span><span class="c1"># By default the outliers are replaced by Nan-values.</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 64</span><span class="c1"># Quality control labels</span>
<span class="linenos"> 65</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 66</span>
<span class="linenos"> 67</span><span class="c1"># Each check makes a label for each observation. These labels are stored in the dataset.df:</span>
<span class="linenos"> 68</span>
<span class="linenos"> 69</span><span class="nb">print</span><span class="p">(</span><span class="n">sept_2022_all_vlinders</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span><span class="c1"># You can see that there is a specific coloumn for each check-label (and for each observationtype that is checked):</span>
<span class="linenos"> 72</span><span class="nb">print</span><span class="p">(</span><span class="n">sept_2022_all_vlinders</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span><span class="c1"># The labels:</span>
<span class="linenos"> 75</span><span class="c1">#   ok: Observation is not flagged as an outlier</span>
<span class="linenos"> 76</span><span class="c1">#   not checked: observation could not be checked (mostly because the observations is already flagged as outlier by a previous check)</span>
<span class="linenos"> 77</span><span class="c1">#   **** outlier: labeld as outlier by the **** check</span>
<span class="linenos"> 78</span>
<span class="linenos"> 79</span>
<span class="linenos"> 80</span><span class="c1"># After applying the Quality control each observations (that is checked) has a set of qc-labels.</span>
<span class="linenos"> 81</span><span class="c1"># To create One column with the final label (based on the labels for each check), you can call the</span>
<span class="linenos"> 82</span><span class="c1"># combine_all_to_obsspace, which will combine observations, outliers gaps and missing timestamps,</span>
<span class="linenos"> 83</span> <span class="c1"># and add a final-qc-label column per obstype:</span>
<span class="linenos"> 84</span>
<span class="linenos"> 85</span><span class="n">outliers_sept_2022_all_vlinders</span> <span class="o">=</span> <span class="n">sept_2022_all_vlinders</span><span class="o">.</span><span class="n">combine_all_to_obsspace</span><span class="p">()</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span><span class="nb">print</span><span class="p">(</span><span class="n">outliers_sept_2022_all_vlinders</span><span class="p">[</span><span class="s1">&#39;temp_final_label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="linenos"> 88</span>
<span class="linenos"> 89</span><span class="c1"># (When writing a dataset to file, there is an attribute &#39;add_final_labels&#39;. When</span>
<span class="linenos"> 90</span><span class="c1">#  True, the final labels are computed and added to the file.)</span>
<span class="linenos"> 91</span>
<span class="linenos"> 92</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 93</span><span class="c1"># Quality control stats</span>
<span class="linenos"> 94</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 95</span>
<span class="linenos"> 96</span><span class="c1">#  Some basic overview statistics are implemented for the quality controll labels.</span>
<span class="linenos"> 97</span><span class="c1">#  You can extract the frequency statistics by calling:</span>
<span class="linenos"> 98</span>
<span class="linenos"> 99</span>    <span class="c1"># obstype: Get statistics of the QC applied on which observationtype</span>
<span class="linenos">100</span>    <span class="c1"># stationnames: Which subset of the dataset to use? If None, statistics are computed over all the stations,</span>
<span class="linenos">101</span>    <span class="c1">#               if one stationname is given the stats are computed for that station. You can also give a list of stationnames.</span>
<span class="linenos">102</span>    <span class="c1"># make_plot:  If True, an overview of pie-charts per check are made.</span>
<span class="linenos">103</span>
<span class="linenos">104</span>    <span class="c1">#The output is a dataframe with frequency statistics per check PRESENTED IN PERSETNTAGES.</span>
<span class="linenos">105</span>
<span class="linenos">106</span><span class="n">qc_statistics</span> <span class="o">=</span> <span class="n">sept_2022_all_vlinders</span><span class="o">.</span><span class="n">get_qc_stats</span><span class="p">(</span><span class="n">obstype</span><span class="o">=</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span>
<span class="linenos">107</span>                                                    <span class="n">stationnames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#or &#39;station_A&#39; or list of stationnames [&#39;station_A&#39;, &#39;station_B&#39;]</span>
<span class="linenos">108</span>                                                    <span class="n">make_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">109</span>
<span class="linenos">110</span><span class="nb">print</span><span class="p">(</span><span class="n">qc_statistics</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="making-spatial-plots">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Making spatial plots</a><a class="headerlink" href="#making-spatial-plots" title="Permalink to this heading"></a></h2>
<p>TODO: make example</p>
</section>
<section id="making-timeseries-plots">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Making timeseries plots</a><a class="headerlink" href="#making-timeseries-plots" title="Permalink to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>
<span class="linenos"> 2</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 3</span><span class="c1"># Timeseries plots</span>
<span class="linenos"> 4</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="c1">#NOTE: All styling settings are defined in the src/vlinder_toolkit/settings_files/default_formats_settings.py</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c1"># plotting the timeseries of all stations can simply be done by</span>
<span class="linenos"> 9</span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span>
<span class="linenos">12</span>                                <span class="c1">#specify the names of the stations in a list, or use None to plot them all.</span>
<span class="linenos">13</span>                                <span class="n">stationnames</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="linenos">14</span>                                <span class="c1">#what obstype to plot (default is &#39;temp&#39;)</span>
<span class="linenos">15</span>                                <span class="n">obstype</span><span class="o">=</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span>
<span class="linenos">16</span>                                <span class="c1">#choose how to color the timeseries:</span>
<span class="linenos">17</span>                                    <span class="c1">#&#39;name&#39; : a specific color per station</span>
<span class="linenos">18</span>                                    <span class="c1">#&#39;label&#39;: a specific color per quality control label</span>
<span class="linenos">19</span>                                <span class="n">colorby</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
<span class="linenos">20</span>                                <span class="c1">#choose a start en endtime for the series (datetime).</span>
<span class="linenos">21</span>                                <span class="c1">#Default is None, wich uses all available data</span>
<span class="linenos">22</span>                                <span class="n">starttime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="linenos">23</span>                                <span class="n">endtime</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
<span class="linenos">24</span>                                <span class="c1">#specify title, by default a title is created</span>
<span class="linenos">25</span>                                <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="linenos">26</span>                                <span class="c1"># Add legend to plot?, by default true</span>
<span class="linenos">27</span>                                <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">28</span>                                <span class="c1"># Plot observations that are labeld as outliers?</span>
<span class="linenos">29</span>                                <span class="n">show_outliers</span><span class="o">=</span><span class="kc">True</span>
<span class="linenos">30</span>                                <span class="p">)</span>
<span class="linenos">31</span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="c1">#To plot timeseries for one station you can use the make_plot function on the station object:</span>
<span class="linenos">34</span><span class="n">favorite_station</span> <span class="o">=</span> <span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">get_station</span><span class="p">(</span><span class="n">stationname</span><span class="o">=</span><span class="s1">&#39;vlinder02&#39;</span><span class="p">)</span>
<span class="linenos">35</span><span class="n">favorite_station</span><span class="o">.</span><span class="n">apply_quality_control</span><span class="p">()</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="c1">#Possible obstypes to plot:</span>
<span class="linenos">38</span>    <span class="c1"># &#39;temp&#39;,&#39;radiation_temp&#39;,&#39;humidity&#39;,&#39;precip&#39;,&#39;precip_sum&#39;,&#39;wind_speed&#39;,</span>
<span class="linenos">39</span>    <span class="c1"># &#39;wind_gust&#39;,&#39;wind_direction&#39;,&#39;pressure&#39;,&#39;pressure_at_sea_level&#39;</span>
<span class="linenos">40</span>
<span class="linenos">41</span>
<span class="linenos">42</span><span class="n">favorite_station</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">obstype</span><span class="o">=</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span>
<span class="linenos">43</span>                           <span class="n">colorby</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span>
<span class="linenos">44</span>                           <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="c1">#if title=None, a title will be generated</span>
<span class="linenos">45</span>
<span class="linenos">46</span><span class="c1">#Nan values will be not shown in the plot</span>
<span class="linenos">47</span>
<span class="linenos">48</span><span class="c1">#If you want to compair multiple stations by a timeseries you can use the make_plot function on the dataset:</span>
<span class="linenos">49</span>
<span class="linenos">50</span><span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">stationnames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;vlinder02&#39;</span><span class="p">,</span> <span class="s1">&#39;vlinder05&#39;</span><span class="p">,</span> <span class="s1">&#39;vlinder07&#39;</span><span class="p">],</span>
<span class="linenos">51</span>                                <span class="n">obstype</span><span class="o">=</span><span class="s1">&#39;humidity&#39;</span><span class="p">,</span>
<span class="linenos">52</span>                                <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="linenos">53</span>                                <span class="n">legend</span><span class="o">=</span><span class="kc">True</span>
<span class="linenos">54</span>                                <span class="p">)</span>
<span class="linenos">55</span><span class="c1">#If you do not specify a start and endtime, all available timestamps are used.</span>
<span class="linenos">56</span>
<span class="linenos">57</span>
</pre></div>
</div>
</section>
<section id="id1">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Making spatial plots</a><a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>
<span class="linenos"> 2</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 3</span><span class="c1"># Geospatial plots</span>
<span class="linenos"> 4</span><span class="c1"># =============================================================================</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="c1"># geospatial plots can be made for a given moment (datetimeinstance) by</span>
<span class="linenos"> 7</span><span class="c1"># applying the make_geo_plot() on a dataset object:</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="n">aug_2020_all_vlinders</span><span class="o">.</span><span class="n">make_geo_plot</span><span class="p">(</span><span class="n">obstype</span><span class="o">=</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span>
<span class="linenos">10</span>                                    <span class="n">timeinstance</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="c1"># 2022/09/06 00:00:00</span>
<span class="linenos">11</span>                                    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="linenos">12</span>                                    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">13</span>                                    <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#value corresponding to the minimum of the colorscheme</span>
<span class="linenos">14</span>                                    <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="c1">#value corresponding to the maximum of the colorscheme</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="c1"># Notes:</span>
<span class="linenos">17</span>    <span class="c1"># * If no timeinstance is given, the first timestamp of the network is used</span>
<span class="linenos">18</span>    <span class="c1"># * vmin and vmax are default (None) set to the minimum and maximum of the observations.</span>
<span class="linenos">19</span>    <span class="c1">#   You can change this if you whant to compair geoplots using the same color scheme</span>
<span class="linenos">20</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="intro.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="usrdocumentation.html" class="btn btn-neutral float-right" title="User documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Thomas Vergauwen.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-XXXXXXXXXX', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>