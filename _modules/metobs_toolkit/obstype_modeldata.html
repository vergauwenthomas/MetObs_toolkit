
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>metobs_toolkit.obstype_modeldata &#8212; MetObs Toolkit documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=643eef25" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/metobs_toolkit/obstype_modeldata';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo_small.svg" class="logo__image only-light" alt="MetObs Toolkit documentation - Home"/>
    <script>document.write(`<img src="../../_static/logo_small.svg" class="logo__image only-dark" alt="MetObs Toolkit documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../index.html">
    Home
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../intro.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../specific_topics.html">
    Specific topics
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../MetObs_documentation_flat.html">
    Documentation
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../topics/contributing_link.html">
    Contributing
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/vergauwenthomas/MetObs_toolkit" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-xl fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../index.html">
    Home
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../intro.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../specific_topics.html">
    Specific topics
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../MetObs_documentation_flat.html">
    Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../topics/contributing_link.html">
    Contributing
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/vergauwenthomas/MetObs_toolkit" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github-square fa-xl fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">metobs_toolk...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for metobs_toolkit.obstype_modeldata</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Class defenition of model observationtypes. These are regular observationtypes</span>
<span class="sd">witht extra attributes and methods for interacting with the google earht engine.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">metobs_toolkit.obstypes</span> <span class="kn">import</span> <span class="n">Obstype</span><span class="p">,</span> <span class="n">expression_calculator</span>

<span class="kn">from</span> <span class="nn">metobs_toolkit.obstypes</span> <span class="kn">import</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">wind_speed</span><span class="p">,</span> <span class="n">direction_aliases</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># =============================================================================</span>
<span class="c1"># Standard modeldata equivalents</span>
<span class="c1"># =============================================================================</span>
<span class="n">tlk_std_modeldata_obstypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;temp&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;ERA5_hourly&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;temperature_2m&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;Kelvin&quot;</span><span class="p">,</span>
            <span class="s2">&quot;band_desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Temperature of air at 2m above the surface of land, sea or in-land waters. 2m temperature is calculated by interpolating between the lowest model level and the Earth&#39;s surface, taking account of the atmospheric conditions.&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;pressure&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;ERA5_hourly&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;surface_pressure&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;pa&quot;</span><span class="p">,</span>
            <span class="s2">&quot;band_desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Pressure (force per unit area) of the atmosphere on the surface of land, sea and in-land water. It is a measure of the weight of all the air in a column vertically above the area of the Earth&#39;s surface represented at a fixed point. Surface pressure is often used in combination with temperature to calculate air density. The strong variation of pressure with altitude makes it difficult to see the low and high pressure systems over mountainous areas, so mean sea level pressure, rather than surface pressure, is normally used for this purpose. The units of this variable are Pascals (Pa). Surface pressure is often measured in hPa and sometimes is presented in the old units of millibars, mb (1 hPa = 1 mb = 100 Pa).&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;u_wind&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;ERA5_hourly&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;u_component_of_wind_10m&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;m/s&quot;</span><span class="p">,</span>
            <span class="s2">&quot;band_desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Eastward component of the 10m wind. It is the horizontal speed of air moving towards the east, at a height of ten meters above the surface of the Earth, in meters per second. Care should be taken when comparing this variable with observations, because wind observations vary on small space and time scales and are affected by the local terrain, vegetation and buildings that are represented only on average in the ECMWF Integrated Forecasting System. This variable can be combined with the V component of 10m wind to give the speed and direction of the horizontal 10m wind.&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;v_wind&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;ERA5_hourly&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;v_component_of_wind_10m&quot;</span><span class="p">,</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;m/s&quot;</span><span class="p">,</span>
            <span class="s2">&quot;band_desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Northward component of the 10m wind. It is the horizontal speed of air moving towards the north, at a height of ten meters above the surface of the Earth, in meters per second. Care should be taken when comparing this variable with observations, because wind observations vary on small space and time scales and are affected by the local terrain, vegetation and buildings that are represented only on average in the ECMWF Integrated Forecasting System. This variable can be combined with the U component of 10m wind to give the speed and direction of the horizontal 10m wind.&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">}</span>


<div class="viewcode-block" id="ModelObstype">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.ModelObstype.html#metobs_toolkit.ModelObstype">[docs]</a>
<span class="k">class</span> <span class="nc">ModelObstype</span><span class="p">(</span><span class="n">Obstype</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extension of the Obstype class specific for the obstypes of Modeldata.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="ModelObstype.__init__">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.ModelObstype.html#metobs_toolkit.ModelObstype.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obstype</span><span class="p">,</span> <span class="n">model_equivalent_dict</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initiate an Modelobservation type.</span>

<span class="sd">        A ModelObstype has the same properties as an Obstype but with some</span>
<span class="sd">        extra attributes and methods.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obsname : str</span>
<span class="sd">            The name of the new observation type (i.g. &#39;sensible_heat_flux&#39;).</span>
<span class="sd">        std_unit : str</span>
<span class="sd">            The standard unit for the observation type (i.g. &#39;J/m²&#39;)</span>
<span class="sd">        obstype_description : str, ptional</span>
<span class="sd">            A more detailed description of the obstype (i.g. &#39;2m SE inside</span>
<span class="sd">            canopy&#39;). The default is None.</span>
<span class="sd">        unit_aliases : dict, optional</span>
<span class="sd">            A dictionary containing unit alias names. Keys represent a unit and</span>
<span class="sd">            values are lists with aliases for the units at the keys. The default is {}.</span>
<span class="sd">        unit_conversions : dict, optional</span>
<span class="sd">            A dictionary containing the conversion information to map to the</span>
<span class="sd">            standard units. Here an example of for temperatures (with Celsius</span>
<span class="sd">            as standard unit):</span>

<span class="sd">                {&#39;Kelvin&#39;: [&quot;x - 273.15&quot;], #result is in tlk_std_units</span>
<span class="sd">                &#39;Farenheit&#39; : [&quot;x-32.0&quot;, &quot;x/1.8&quot;]}, # --&gt;execute from left to write  = (x-32)/1.8</span>

<span class="sd">                The default is {}.</span>

<span class="sd">        model_equiv_dict : dict</span>
<span class="sd">            A dictionary with information of how the observation type is found in</span>
<span class="sd">            modeldata. A example for pressure is:</span>

<span class="sd">                {&#39;ERA5_hourly&#39;: {&#39;name&#39;: &#39;surface_pressure&#39;, &#39;units&#39;: &#39;pa&#39;,</span>
<span class="sd">                                             &#39;band_desc&#39;: &quot;Pressure (force per ....</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">obsname</span><span class="o">=</span><span class="n">obstype</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">std_unit</span><span class="o">=</span><span class="n">obstype</span><span class="o">.</span><span class="n">std_unit</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">obstype</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
            <span class="n">unit_aliases</span><span class="o">=</span><span class="n">obstype</span><span class="o">.</span><span class="n">units_aliases</span><span class="p">,</span>
            <span class="n">unit_conversions</span><span class="o">=</span><span class="n">obstype</span><span class="o">.</span><span class="n">conv_table</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">modl_equi_dict</span> <span class="o">=</span> <span class="n">model_equivalent_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_data_unit</span> <span class="o">=</span> <span class="p">(</span>
            <span class="kc">None</span>  <span class="c1"># represents at any time the unit of the data stored</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Instance representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ModelObstype instance of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Text representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ModelObstype instance of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print out detailed information of the observation type.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">databands</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modl_equi_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">info_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> observation with: </span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">    * Known datasetsbands: </span><span class="si">{</span><span class="n">databands</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">    * standard unit: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">std_unit</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">    * description: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">    * conversions to known units: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">conv_table</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">info_str</span><span class="p">)</span>

<div class="viewcode-block" id="ModelObstype.get_mapped_datasets">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.ModelObstype.get_mapped_datasets.html#metobs_toolkit.ModelObstype.get_mapped_datasets">[docs]</a>
    <span class="k">def</span> <span class="nf">get_mapped_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all gee datasets with a representing band for this obstype.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modl_equi_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


<div class="viewcode-block" id="ModelObstype.get_bandname">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.ModelObstype.get_bandname.html#metobs_toolkit.ModelObstype.get_bandname">[docs]</a>
    <span class="k">def</span> <span class="nf">get_bandname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the representing bandname of the obstype from a given gee dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modl_equi_dict</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="ModelObstype.get_bandname_mapper">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.ModelObstype.get_bandname_mapper.html#metobs_toolkit.ModelObstype.get_bandname_mapper">[docs]</a>
    <span class="k">def</span> <span class="nf">get_bandname_mapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the representing bandname with tlk standard name as a dict.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modl_equi_dict</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]):</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">}</span></div>


    <span class="k">def</span> <span class="nf">get_plot_y_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string to represent the vertical axes of a plot.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">std_unit</span><span class="si">}</span><span class="s1">) </span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">mapname</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">modl_equi_dict</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>

<div class="viewcode-block" id="ModelObstype.get_modelunit">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.ModelObstype.get_modelunit.html#metobs_toolkit.ModelObstype.get_modelunit">[docs]</a>
    <span class="k">def</span> <span class="nf">get_modelunit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the units of the representing bandname of the obstype from a given gee dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modl_equi_dict</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="s2">&quot;units&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="ModelObstype.has_mapped_band">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.ModelObstype.has_mapped_band.html#metobs_toolkit.ModelObstype.has_mapped_band">[docs]</a>
    <span class="k">def</span> <span class="nf">has_mapped_band</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test is a gee dataset has a representing band.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_bandname</span><span class="p">(</span><span class="n">mapname</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


    <span class="k">def</span> <span class="nf">get_current_data_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current unit of the corresponding data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_data_unit</span>

    <span class="k">def</span> <span class="nf">setup_current_data_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the current data unit to the one define by the corresponding band.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_data_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modelunit</span><span class="p">(</span><span class="n">mapname</span><span class="o">=</span><span class="n">mapname</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">set_current_data_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_data_unit</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the current data unit.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">current_data_unit</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_units</span><span class="p">()</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_data_unit</span><span class="si">}</span><span class="s2"> is not a known unit for </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_data_unit</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_data_unit</span><span class="p">)</span>
        <span class="k">return</span>

<div class="viewcode-block" id="ModelObstype.add_new_band">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.ModelObstype.add_new_band.html#metobs_toolkit.ModelObstype.add_new_band">[docs]</a>
    <span class="k">def</span> <span class="nf">add_new_band</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapname</span><span class="p">,</span> <span class="n">bandname</span><span class="p">,</span> <span class="n">bandunit</span><span class="p">,</span> <span class="n">band_desc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a new representing dataset/bandname to the obstype.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mapname : str</span>
<span class="sd">            name of the known gee dataset.</span>
<span class="sd">        bandname : str</span>
<span class="sd">            the name of the representing band.</span>
<span class="sd">        bandunit : str</span>
<span class="sd">            the unit of the representing band.</span>
<span class="sd">        band_desc : str, optional</span>
<span class="sd">            A detailed description of the band.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># test if banunit is valid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_if_unit_is_known</span><span class="p">(</span><span class="n">bandunit</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bandunit</span><span class="si">}</span><span class="s2"> is an unknown unit for the </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> obstype.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modl_equi_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># check if band is already knonw</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Update </span><span class="si">{</span><span class="n">bandname</span><span class="si">}</span><span class="s2"> of (known) map: </span><span class="si">{</span><span class="n">mapname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Add new map: </span><span class="si">{</span><span class="n">mapname</span><span class="si">}</span><span class="s2"> with band: </span><span class="si">{</span><span class="n">bandname</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modl_equi_dict</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">bandname</span><span class="p">),</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">bandunit</span><span class="p">),</span>
            <span class="s2">&quot;band_desc&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">band_desc</span><span class="p">),</span>
        <span class="p">}</span></div>


    <span class="k">def</span> <span class="nf">_is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if all attributes are valid among each other.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">datasetname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modl_equi_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Check if unit is available</span>
            <span class="k">if</span> <span class="s2">&quot;units&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modl_equi_dict</span><span class="p">[</span><span class="n">datasetname</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No units information is provided for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> for modeldata: </span><span class="si">{</span><span class="n">datasetname</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="c1"># check if the unit is known</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_if_unit_is_known</span><span class="p">(</span>
                <span class="n">unit_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modl_equi_dict</span><span class="p">[</span><span class="n">datasetname</span><span class="p">][</span><span class="s2">&quot;units&quot;</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Cannot create </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> ModelObstype because </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">modl_equi_dict</span><span class="p">[</span><span class="n">datasetname</span><span class="p">][</span><span class="s2">&quot;units&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> is a unknown unit.&#39;</span>
                <span class="p">)</span></div>



<div class="viewcode-block" id="ModelObstype_Vectorfield">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.ModelObstype_Vectorfield.html#metobs_toolkit.ModelObstype_Vectorfield">[docs]</a>
<span class="k">class</span> <span class="nc">ModelObstype_Vectorfield</span><span class="p">(</span><span class="n">Obstype</span><span class="p">):</span>
<div class="viewcode-block" id="ModelObstype_Vectorfield.__init__">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.ModelObstype_Vectorfield.html#metobs_toolkit.ModelObstype_Vectorfield.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">obstype</span><span class="p">,</span> <span class="n">u_comp_model_equivalent_dict</span><span class="o">=</span><span class="p">{},</span> <span class="n">v_comp_model_equivalent_dict</span><span class="o">=</span><span class="p">{}</span>
    <span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">obsname</span><span class="o">=</span><span class="n">obstype</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">std_unit</span><span class="o">=</span><span class="n">obstype</span><span class="o">.</span><span class="n">std_unit</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">obstype</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
            <span class="n">unit_aliases</span><span class="o">=</span><span class="n">obstype</span><span class="o">.</span><span class="n">units_aliases</span><span class="p">,</span>
            <span class="n">unit_conversions</span><span class="o">=</span><span class="n">obstype</span><span class="o">.</span><span class="n">conv_table</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">u_comp_model_equivalent_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">v_comp_model_equivalent_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The mapped gee dataset are not equal for the vector components of </span><span class="si">{</span><span class="n">obstype</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="n">mod_comp_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">geedataset</span> <span class="ow">in</span> <span class="n">u_comp_model_equivalent_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">mod_comp_dict</span><span class="p">[</span><span class="n">geedataset</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;u_comp&quot;</span><span class="p">:</span> <span class="n">u_comp_model_equivalent_dict</span><span class="p">[</span><span class="n">geedataset</span><span class="p">],</span>
                <span class="s2">&quot;v_comp&quot;</span><span class="p">:</span> <span class="n">v_comp_model_equivalent_dict</span><span class="p">[</span><span class="n">geedataset</span><span class="p">],</span>
            <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">modl_comp_dict</span> <span class="o">=</span> <span class="n">mod_comp_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_data_unit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Instance representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ModelObstype_Vectorfield instance of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Text representation.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ModelObstype_Vectorfield instance of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print out detailed information of the observation type.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u_databands</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;u_comp&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">v_databands</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;v_comp&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">info_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> observation with: </span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">    * Known Vector-East-component datasetsbands: </span><span class="si">{</span><span class="n">u_databands</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">    * Known Vector-North-component datasetsbands: </span><span class="si">{</span><span class="n">v_databands</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">    * standard unit: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">std_unit</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">    * description: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">    * conversions to known units: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">conv_table</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">info_str</span><span class="p">)</span>

<div class="viewcode-block" id="ModelObstype_Vectorfield.get_mapped_datasets">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.ModelObstype_Vectorfield.get_mapped_datasets.html#metobs_toolkit.ModelObstype_Vectorfield.get_mapped_datasets">[docs]</a>
    <span class="k">def</span> <span class="nf">get_mapped_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all gee datasets with a representing band for this obstype.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


    <span class="c1"># def get_bandname(self, mapname):</span>
    <span class="c1">#     &quot;&quot;&quot;Return the representing bandname of the obstype from a given gee dataset.&quot;&quot;&quot;</span>
    <span class="c1">#     return str(self.modl_equi_dict[mapname][&#39;name&#39;])</span>

<div class="viewcode-block" id="ModelObstype_Vectorfield.get_bandname_mapper">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.ModelObstype_Vectorfield.get_bandname_mapper.html#metobs_toolkit.ModelObstype_Vectorfield.get_bandname_mapper">[docs]</a>
    <span class="k">def</span> <span class="nf">get_bandname_mapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the representing bandname with tlk standard name as a dict.&quot;&quot;&quot;</span>
        <span class="n">mapper</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="s2">&quot;u_comp&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]):</span> <span class="sa">f</span><span class="s2">&quot;u_comp_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="s2">&quot;v_comp&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]):</span> <span class="sa">f</span><span class="s2">&quot;v_comp_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">mapper</span></div>


<div class="viewcode-block" id="ModelObstype_Vectorfield.get_modelunit">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.ModelObstype_Vectorfield.get_modelunit.html#metobs_toolkit.ModelObstype_Vectorfield.get_modelunit">[docs]</a>
    <span class="k">def</span> <span class="nf">get_modelunit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the units of the representing bandname of the obstype from a given gee dataset.&quot;&quot;&quot;</span>
        <span class="c1"># u and v comp must have the same units, this is tested in the _is_valid()</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="s2">&quot;u_comp&quot;</span><span class="p">][</span><span class="s2">&quot;units&quot;</span><span class="p">])</span></div>


    <span class="k">def</span> <span class="nf">get_current_data_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current unit of the corresponding data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_data_unit</span>

    <span class="k">def</span> <span class="nf">setup_current_data_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the current data unit to the one define by the corresponding band.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_data_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_modelunit</span><span class="p">(</span><span class="n">mapname</span><span class="o">=</span><span class="n">mapname</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">set_current_data_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_data_unit</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the current data unit.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">current_data_unit</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_units</span><span class="p">()</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_data_unit</span><span class="si">}</span><span class="s2"> is not a known unit for </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_data_unit</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_data_unit</span><span class="p">)</span>
        <span class="k">return</span>

<div class="viewcode-block" id="ModelObstype_Vectorfield.has_mapped_band">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.ModelObstype_Vectorfield.has_mapped_band.html#metobs_toolkit.ModelObstype_Vectorfield.has_mapped_band">[docs]</a>
    <span class="k">def</span> <span class="nf">has_mapped_band</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test is a gee dataset has a representing band.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>


    <span class="k">def</span> <span class="nf">get_plot_y_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapname</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string to represent the vertical axes of a plot.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">std_unit</span><span class="si">}</span><span class="s1">) </span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">mapname</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">modl_equi_dict</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="s2">&quot;u_comp&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">modl_equi_dict</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="s2">&quot;v_comp&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">get_u_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;u_comp_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">get_v_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;v_comp_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="ModelObstype_Vectorfield.add_new_band">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.ModelObstype_Vectorfield.add_new_band.html#metobs_toolkit.ModelObstype_Vectorfield.add_new_band">[docs]</a>
    <span class="k">def</span> <span class="nf">add_new_band</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mapname</span><span class="p">,</span>
        <span class="n">bandname_u_comp</span><span class="p">,</span>
        <span class="n">bandname_v_comp</span><span class="p">,</span>
        <span class="n">bandunit</span><span class="p">,</span>
        <span class="n">band_desc_u_comp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">band_desc_v_comp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a new representing dataset/bandname to the obstype.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mapname : str</span>
<span class="sd">            name of the known gee dataset.</span>
<span class="sd">        bandname_u_comp : str</span>
<span class="sd">            the name of the representing the Eastwards component band.</span>
<span class="sd">        bandname_v_comp : str</span>
<span class="sd">            the name of the representing the Northwards component band.</span>
<span class="sd">        bandunit : str</span>
<span class="sd">            the unit of the representing bands.</span>
<span class="sd">        band_desc_u_comp : str, optional</span>
<span class="sd">            A detailed description of the Eastwards component of the band.</span>
<span class="sd">        band_desc_v_comp : str, optional</span>
<span class="sd">            A detailed description of the Northwards component of the band.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># test if banunit is valid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_if_unit_is_known</span><span class="p">(</span><span class="n">bandunit</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bandunit</span><span class="si">}</span><span class="s2"> is an unknown unit for the </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> obstype.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mapname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># check if band is already knonw</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Update </span><span class="si">{</span><span class="n">bandname_u_comp</span><span class="si">}</span><span class="s2"> of (known) map: </span><span class="si">{</span><span class="n">mapname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Add new map: </span><span class="si">{</span><span class="n">mapname</span><span class="si">}</span><span class="s2"> with band: </span><span class="si">{</span><span class="n">bandname_u_comp</span><span class="w"> </span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="p">[</span><span class="n">mapname</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="s2">&quot;u_comp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">bandname_u_comp</span><span class="p">),</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">bandunit</span><span class="p">),</span>
            <span class="s2">&quot;band_desc&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">band_desc_u_comp</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="p">[</span><span class="n">mapname</span><span class="p">][</span><span class="s2">&quot;v_comp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">bandname_v_comp</span><span class="p">),</span>
            <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">bandunit</span><span class="p">),</span>
            <span class="s2">&quot;band_desc&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">band_desc_v_comp</span><span class="p">),</span>
        <span class="p">}</span></div>


    <span class="k">def</span> <span class="nf">_is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if all attributes are valid among each other.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">datasetname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">comp_str</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="p">[</span><span class="n">datasetname</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Check if unit is available</span>
                <span class="k">if</span> <span class="s2">&quot;units&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;No units information is provided for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">comp_str</span><span class="si">}</span><span class="s2"> modeldata_vectorfield: </span><span class="si">{</span><span class="n">datasetname</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="c1"># check if the unit is known</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_if_unit_is_known</span><span class="p">(</span><span class="n">unit_name</span><span class="o">=</span><span class="n">comp</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]):</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;Cannot create </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> ModelObstype_Vectorfield because </span><span class="si">{</span><span class="n">comp</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> is a unknown unit in the </span><span class="si">{</span><span class="n">comp_str</span><span class="si">}</span><span class="s1">.&#39;</span>
                    <span class="p">)</span>

            <span class="c1"># check if the units of the u and v comp are equal</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span>
                    <span class="nb">set</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="p">[</span><span class="n">datasetname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="p">):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The units of the u and v component for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> in the </span><span class="si">{</span><span class="n">datasetname</span><span class="si">}</span><span class="s2"> dataset are not equal.&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">convert_to_standard_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_df</span><span class="p">,</span> <span class="n">input_unit</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert data from a known unit to the standard unit.</span>

<span class="sd">        The data must be a pandas dataframe with both the u and v component</span>
<span class="sd">        prensent as columns.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        input_data : (collection of) numeric</span>
<span class="sd">            The data to convert to the standard unit.</span>
<span class="sd">        input_unit : str</span>
<span class="sd">            The known unit the inputdata is in.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data_u_component :  numeric/numpy.array</span>
<span class="sd">            The u component of the data in standard units.</span>
<span class="sd">        data_v_component :</span>
<span class="sd">            The v component of the data in standard units.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if input unit is known</span>
        <span class="n">known</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_if_unit_is_known</span><span class="p">(</span><span class="n">input_unit</span><span class="p">)</span>

        <span class="c1"># error when unit is not know</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">known</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_unit</span><span class="si">}</span><span class="s2"> is an unknown unit for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">. No coversion possible!&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Get conversion</span>
        <span class="n">std_unit_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_std_unit_name</span><span class="p">(</span><span class="n">input_unit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">std_unit_name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">std_unit</span><span class="p">:</span>
            <span class="c1"># No conversion needed because already the standard unit</span>
            <span class="k">return</span> <span class="n">input_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_u_column</span><span class="p">()],</span> <span class="n">input_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_v_column</span><span class="p">()]</span>

        <span class="n">conv_expr_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_table</span><span class="p">[</span><span class="n">std_unit_name</span><span class="p">]</span>

        <span class="c1"># covert data u component</span>
        <span class="n">data_u</span> <span class="o">=</span> <span class="n">input_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_u_column</span><span class="p">()]</span>
        <span class="n">data_v</span> <span class="o">=</span> <span class="n">input_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_v_column</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">conv</span> <span class="ow">in</span> <span class="n">conv_expr_list</span><span class="p">:</span>
            <span class="n">data_u</span> <span class="o">=</span> <span class="n">expression_calculator</span><span class="p">(</span><span class="n">conv</span><span class="p">,</span> <span class="n">data_u</span><span class="p">)</span>
            <span class="n">data_v</span> <span class="o">=</span> <span class="n">expression_calculator</span><span class="p">(</span><span class="n">conv</span><span class="p">,</span> <span class="n">data_v</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_u</span><span class="p">,</span> <span class="n">data_v</span></div>



<span class="c1"># %% New obs creator functions</span>
<div class="viewcode-block" id="compute_amplitude">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.obstype_modeldata.compute_amplitude.html#metobs_toolkit.compute_amplitude">[docs]</a>
<span class="k">def</span> <span class="nf">compute_amplitude</span><span class="p">(</span><span class="n">modelobs_vectorfield</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute amplitude of 2D vectorfield components.</span>

<span class="sd">    The amplitude column is added to the dataframe and a new ModelObstype,</span>
<span class="sd">    representing the amplitude is returned. All attributes wrt the units are</span>
<span class="sd">    inherited from the ModelObstype_vectorfield.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    modelobs_vectorfield : ModelObstype_Vectorfield</span>
<span class="sd">        The vectorfield observation type to compute the vector amplitudes for.</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        The dataframe with the vector components present as columns.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        The df with an extra column representing the amplitudes.</span>
<span class="sd">    amplitude_obstype : ModelObstype</span>
<span class="sd">        The (scalar) Modelobstype representation of the amplitudes.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compute the data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">modelobs_vectorfield</span><span class="o">.</span><span class="n">get_u_column</span><span class="p">()]</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="o">+</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">modelobs_vectorfield</span><span class="o">.</span><span class="n">get_v_column</span><span class="p">()]</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="p">)</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># Create a new obstype for the amplitude</span>
    <span class="n">amplitude_obstype</span> <span class="o">=</span> <span class="n">Obstype</span><span class="p">(</span>
        <span class="n">obsname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">modelobs_vectorfield</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_amplitude&quot;</span><span class="p">,</span>
        <span class="n">std_unit</span><span class="o">=</span><span class="n">modelobs_vectorfield</span><span class="o">.</span><span class="n">std_unit</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;2D-vector amplitde of </span><span class="si">{</span><span class="n">modelobs_vectorfield</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> components.&quot;</span><span class="p">,</span>
        <span class="n">unit_aliases</span><span class="o">=</span><span class="n">modelobs_vectorfield</span><span class="o">.</span><span class="n">units_aliases</span><span class="p">,</span>
        <span class="n">unit_conversions</span><span class="o">=</span><span class="n">modelobs_vectorfield</span><span class="o">.</span><span class="n">conv_table</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># convert to model obstype</span>
    <span class="n">new_mod_equi</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">modelobs_vectorfield</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new_mod_equi</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s2">&quot;u_comp&quot;</span><span class="p">]</span>
        <span class="n">new_mod_equi</span><span class="p">[</span><span class="n">key</span><span class="p">][</span>
            <span class="s2">&quot;name&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;u_comp&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;v_comp&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">amplitude_obstype</span> <span class="o">=</span> <span class="n">ModelObstype</span><span class="p">(</span>
        <span class="n">amplitude_obstype</span><span class="p">,</span> <span class="n">model_equivalent_dict</span><span class="o">=</span><span class="n">new_mod_equi</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">amplitude_obstype</span></div>



<div class="viewcode-block" id="compute_angle">
<a class="viewcode-back" href="../../reference/api/metobs_toolkit.obstype_modeldata.compute_angle.html#metobs_toolkit.compute_angle">[docs]</a>
<span class="k">def</span> <span class="nf">compute_angle</span><span class="p">(</span><span class="n">modelobs_vectorfield</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute vector direction of 2D vectorfield components.</span>

<span class="sd">    The direction column is added to the dataframe and a new ModelObstype,</span>
<span class="sd">    representing the angle is returned. The values represents the angles in</span>
<span class="sd">    degrees, from north in clock-wise rotation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    modelobs_vectorfield : ModelObstype_Vectorfield</span>
<span class="sd">        The vectorfield observation type to compute the vector directions for.</span>
<span class="sd">    df : pandas.DataFrame</span>
<span class="sd">        The dataframe with the vector components present as columns.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    data : pandas.DataFrame</span>
<span class="sd">        The df with an extra column representing the directions.</span>
<span class="sd">    amplitude_obstype : ModelObstype</span>
<span class="sd">        The (scalar) Modelobstype representation of the angles.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">unit_vector</span><span class="p">(</span><span class="n">vector</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the unit vector of the vector.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">vector</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">angle_between</span><span class="p">(</span><span class="n">u_comp</span><span class="p">,</span> <span class="n">v_comp</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the angle in ° from North (CW) from 2D Vector components.&quot;&quot;&quot;</span>

        <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_comp</span><span class="p">,</span> <span class="n">v_comp</span><span class="p">)</span>
        <span class="n">v1_u</span> <span class="o">=</span> <span class="n">unit_vector</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># North unit arrow</span>
        <span class="n">v2_u</span> <span class="o">=</span> <span class="n">unit_vector</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>

        <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v1_u</span><span class="p">,</span> <span class="n">v2_u</span><span class="p">),</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="n">angle_degrees</span> <span class="o">=</span> <span class="n">angle_rad</span> <span class="o">*</span> <span class="p">((</span><span class="mf">180.0</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="c1"># return angle_degrees</span>
        <span class="c1"># fix the quadrants</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1"># N-E quadrant</span>
            <span class="k">return</span> <span class="n">angle_degrees</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1"># S-E quadrant</span>
            <span class="k">return</span> <span class="n">angle_degrees</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1"># S-W quadrant</span>
            <span class="k">return</span> <span class="mf">180.0</span> <span class="o">+</span> <span class="p">(</span><span class="mf">180.0</span> <span class="o">-</span> <span class="n">angle_degrees</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1"># N-W quadrant</span>
            <span class="k">return</span> <span class="mf">360.0</span> <span class="o">-</span> <span class="n">angle_degrees</span>

    <span class="n">u_column</span> <span class="o">=</span> <span class="n">modelobs_vectorfield</span><span class="o">.</span><span class="n">get_u_column</span><span class="p">()</span>
    <span class="n">v_column</span> <span class="o">=</span> <span class="n">modelobs_vectorfield</span><span class="o">.</span><span class="n">get_v_column</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">angle_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">u_column</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">v_column</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Create a new obstype for the amplitude</span>
    <span class="n">direction_obstype</span> <span class="o">=</span> <span class="n">Obstype</span><span class="p">(</span>
        <span class="n">obsname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">modelobs_vectorfield</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_direction&quot;</span><span class="p">,</span>
        <span class="n">std_unit</span><span class="o">=</span><span class="s2">&quot;° from north (CW)&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Direction of 2D-vector of </span><span class="si">{</span><span class="n">modelobs_vectorfield</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> components.&quot;</span><span class="p">,</span>
        <span class="n">unit_aliases</span><span class="o">=</span><span class="n">direction_aliases</span><span class="p">,</span>
        <span class="n">unit_conversions</span><span class="o">=</span><span class="p">{},</span>
    <span class="p">)</span>
    <span class="c1"># convert to model obstype</span>
    <span class="n">new_mod_equi</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">modelobs_vectorfield</span><span class="o">.</span><span class="n">modl_comp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">new_mod_equi</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s2">&quot;u_comp&quot;</span><span class="p">]</span>
        <span class="n">new_mod_equi</span><span class="p">[</span><span class="n">key</span><span class="p">][</span>
            <span class="s2">&quot;name&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;u_comp&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;v_comp&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">new_mod_equi</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;° from north (CW)&quot;</span>

    <span class="n">direction_obstype</span> <span class="o">=</span> <span class="n">ModelObstype</span><span class="p">(</span>
        <span class="n">direction_obstype</span><span class="p">,</span> <span class="n">model_equivalent_dict</span><span class="o">=</span><span class="n">new_mod_equi</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">direction_obstype</span></div>



<span class="c1"># =============================================================================</span>
<span class="c1"># Define obstypes</span>
<span class="c1"># =============================================================================</span>

<span class="n">temp_model</span> <span class="o">=</span> <span class="n">ModelObstype</span><span class="p">(</span>
    <span class="n">temperature</span><span class="p">,</span> <span class="n">model_equivalent_dict</span><span class="o">=</span><span class="n">tlk_std_modeldata_obstypes</span><span class="p">[</span><span class="s2">&quot;temp&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">pressure_model</span> <span class="o">=</span> <span class="n">ModelObstype</span><span class="p">(</span>
    <span class="n">pressure</span><span class="p">,</span> <span class="n">model_equivalent_dict</span><span class="o">=</span><span class="n">tlk_std_modeldata_obstypes</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Special obstypes</span>
<span class="n">wind_speed</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;wind_speed&quot;</span>
<span class="n">wind_model</span> <span class="o">=</span> <span class="n">ModelObstype_Vectorfield</span><span class="p">(</span>
    <span class="n">wind_speed</span><span class="p">,</span>
    <span class="n">u_comp_model_equivalent_dict</span><span class="o">=</span><span class="n">tlk_std_modeldata_obstypes</span><span class="p">[</span><span class="s2">&quot;u_wind&quot;</span><span class="p">],</span>
    <span class="n">v_comp_model_equivalent_dict</span><span class="o">=</span><span class="n">tlk_std_modeldata_obstypes</span><span class="p">[</span><span class="s2">&quot;v_wind&quot;</span><span class="p">],</span>
<span class="p">)</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># Create obstype dict</span>
<span class="c1"># =============================================================================</span>
<span class="n">model_obstypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;temp&quot;</span><span class="p">:</span> <span class="n">temp_model</span><span class="p">,</span>
    <span class="s2">&quot;pressure&quot;</span><span class="p">:</span> <span class="n">pressure_model</span><span class="p">,</span>
    <span class="s2">&quot;wind_speed&quot;</span><span class="p">:</span> <span class="n">wind_model</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2023, Thomas Vergauwen.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.4.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>